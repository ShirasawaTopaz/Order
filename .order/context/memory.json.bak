{
  "tasks": {
    "default": {
      "project_rules": [
        "### 2. 能力降级策略稳健化（Capability Fallback Hardening）功能目标：- 将基于错误文案猜测降级升级为可解释、可复用、可验证的降级决策流程。- 在多 provider / 多网关场景下，降低误判降级、重复失败和无效重试。- 确保降级结果可以被缓存并带有效期管理，避免长期固化错误状态。技术方案：- 在 `crates/c...",
        "### 3. 可观测性补齐 Token/成本维度（Usage & Cost Observability）功能目标：- 除成功率/耗时/重试率外，提供 token 用量与成本的统一统计。- 支持按 provider/model/任务维度追踪消耗，便于容量规划和成本控制。- 让每次请求的产出与消耗可对齐到同一 `trace_id`。技术方案：- 扩展 `A...",
        "- 提供统一 usage 提取接口（先做通用 JSON/文本兜底，不阻断主流程）"
      ],
      "preferences": [
        "1. 新增 `ErrorClassifier`（建议文件：`crates/core/src/model/error_classifier.rs`）",
        "2. 新增 `CapabilityFallbackPlan`（建议文件：`crates/core/src/model/fallback_plan.rs`）",
        "- 文件建议：`crates/core/src/model/provider_usage_extractor.rs`",
        "- 文件建议：`crates/core/src/model/pricing.rs`"
      ],
      "key_decisions": [
        "3) `response_inner` 改为“先分类后决策”的状态机",
        "- 根据错误分类 + 当前 capability 决定可否降级",
        "- 将 `response_inner` 改为“先分类后决策”的状态机"
      ],
      "updated_at": "2026-02-14 22:12:11"
    }
  }
}
